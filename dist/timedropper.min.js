/**
 * timedropper-ex
 * @version v1.3.0
 * @link https://adam5wu.github.io/TimeDropper-Ex/
 * @license MIT
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(n),n}:t(window.jQuery)}(function(t){t.fn.extend({timeDropper:function(e){var n=this,i=!1,s=t(".td-clock").length,a=null,o=null,d=null,r=t.extend({format:"hh:mm A",fetchTime:function(){return n.val()},setTime:function(t){t!=n.val()&&(n.val(t),n.change())},autoSwitch:!0,meridians:!0,mousewheel:!0,animation:"drop",showLancets:!0,dropTrigger:!0,startFrom:"hr",handleShake:!1,autoStart:!1,stickyMinute:20,stickyHour:480},e);(r.visualContainer?r.visualContainer:t("body")).append('<div class="td-clock" id="td-clock-'+s+'"><div class="td-clock-wrap"><div class="td-medirian"><span class="td-am td-n2">AM</span><span class="td-pm td-n2">PM</span><span class="td-now td-n2 td-on">Reset</span></div><div class="td-lancette"><div class="td-tick td-rotate-0"></div><div class="td-tick td-rotate-30"></div><div class="td-tick td-rotate-60"></div><div class="td-tick td-rotate-90"></div><div class="td-tick td-rotate-120"></div><div class="td-tick td-rotate-150"></div><div class="td-tick td-rotate-180"></div><div class="td-tick td-rotate-210"></div><div class="td-tick td-rotate-240"></div><div class="td-tick td-rotate-270"></div><div class="td-tick td-rotate-300"></div><div class="td-tick td-rotate-330"></div><div class="td-pointer td-hr"></div><div class="td-pointer td-min"></div></div><div class="td-time"><span class="td-hr td-n2"></span>:<span class="td-min td-n2"></span></div><div class="td-dail td-n"><div class="td-handle"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"x="0px" y="0px" viewBox="0 0 100 35.4" enable-background="new 0 0 100 35.4" xml:space="preserve"><g><path fill="none" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"stroke-miterlimit="10" d="M98.1,33C85.4,21.5,68.5,14.5,50,14.5S14.6,21.5,1.9,33"/><line fill="none" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"stroke-miterlimit="10" x1="1.9" y1="33" x2="1.9" y2="28.6"/><line fill="none" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"stroke-miterlimit="10" x1="1.9" y1="33" x2="6.3" y2="33"/><line fill="none" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"stroke-miterlimit="10" x1="98.1" y1="33" x2="93.7" y2="33"/><line fill="none" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"stroke-miterlimit="10" x1="98.1" y1="33" x2="98.1" y2="28.6"/></g></svg></div></div></div></div>');var l=t("#td-clock-"+s),c=l.find(".td-lancette"),u=l.find(".td-pointer"),f=c.find(".td-hr"),v=c.find(".td-min"),m=l.find(".td-hr"),h=l.find(".td-min"),p=l.find(".td-dail"),g=p.find(".td-handle"),k=p.find("svg"),w=l.find(".td-medirian"),C=w.find("span"),x=w.find(".td-am"),y=w.find(".td-pm"),b=w.find(".td-now"),T=l.find(".td-time"),D=T.find("span"),M=T.find(".td-hr"),E=T.find(".td-min");r.showLancets||c.attr("style","display:none"),r.dropTrigger||l.addClass("nodrop");var H=function(t){return t<10?"0"+t:t},I=function(t){var e=new Date,n=t.match(/^(\d\d)(?::(\d\d))?(?::(\d\d))?\s*(am|pm)?$/i);if(n)return e.setHours((parseInt(n[1])||0)+(n[4]&&"PM"==n[4].toUpperCase()?12:0),parseInt(n[2])||0,parseInt(n[3])||0),e},_=function(t,e,n){var i=t>12?t-12:t;return disp_a=t>12?"pm":"am",disp_s=n,r.format.replace(/\b(HH)\b/g,H(t)).replace(/\b(hh)\b/g,H(i)).replace(/\b(mm)\b/g,H(e)).replace(/\b(ss)\b/g,H(disp_s)).replace(/\b(H)\b/g,t).replace(/\b(h)\b/g,i).replace(/\b(m)\b/g,e).replace(/\b(s)\b/g,disp_s).replace(/\b(A)\b/g,disp_a.toUpperCase()).replace(/\b(a)\b/g,disp_a)},j=null,S=0,P=0,q=0,z=!1,A=0,U=function(t,e){if(S!=t){S=t%86400,S<0&&(S+=86400);var s=Math.floor(S/3600),a=S%3600,d=Math.floor(a/60),l=360*a/3600,c=360*s/12;P=c%360+l/12,q=l,z=s>=12,f.css("transform","rotate("+P+"deg)"),v.css("transform","rotate("+q+"deg)"),M.attr("data-id",s).text(H(r.meridians&&s>12?s-12:s)),E.attr("data-id",d).text(H(d)),r.meridians&&(z?(x.removeClass("td-on"),y.addClass("td-on")):(x.addClass("td-on"),y.removeClass("td-on"))),j&&(j.hasClass("td-hr")?p.css("transform","rotate("+P+"deg)"):p.css("transform","rotate("+q+"deg)"));var u=_(s,d,a%60);r.setTime(u),n.trigger("TDEx-update",{dailing:i,selector:j?j.hasClass("td-hr")?"hr":"min":null,now:e,time:[S,u]}),!e&&o&&(clearInterval(o),o=null,b.addClass("td-on"))}},F=function(t){var e=S%3600,n=Math.round(3600*t/360);if(r.stickyMinute>1){var i=n%60,s=60-i;if((i<r.stickyMinute||s<r.stickyMinute)&&(n=(n-i+(i<r.stickyMinute?0:60))%3600,t=360*n/3600),t==q)return}var a=t>q?t-q:q-t,o=a<=180?0:t<q?3600:-3600;U(S-e+n+o)},L=function(t){var e=S%43200,n=Math.round(3600*t*12/360);if(r.stickyHour>1){var i=n%3600,s=3600-i;if((i<r.stickyHour||s<r.stickyHour)&&(n=(n-i+(i<r.stickyHour?0:3600))%43200,t=360*n/43200),t==P)return}var a=t>P?t-P:P-t,o=a<=180?0:t<P?43200:-43200;U(S-e+n+o)},W=function(t){j=t,j?(j.hasClass("td-hr")?(m.addClass("td-on"),h.removeClass("td-on"),A=P):(m.removeClass("td-on"),h.addClass("td-on"),A=q),p.addClass("td-n"),p.addClass("active"),p.css("transform","rotate("+A+"deg)")):(m.removeClass("td-on"),h.removeClass("td-on"),p.removeClass("active")),n.trigger("TDEx-selector",{selector:j?j.hasClass("td-hr")?"hr":"min":null})},X=function(e){e.preventDefault(),e.stopPropagation(),W(t(this))};D.on("click",X);var Y=function(t){null==d&&W(null)};l.on("click",Y);var B=function(t){n.trigger("TDEx-meridian",{clicked:z?"am":"pm"}),U(z?S-43200:S+43200)},Q=function(t){n.trigger("TDEx-meridian",{clicked:"now"}),G(null)};r.meridians&&(x.on("click",B),y.on("click",B),b.on("click",Q));var R=function(e){if(j){e.preventDefault(),e.stopPropagation(),n.trigger("TDEx-dailing",{finish:!1,selector:j.hasClass("td-hr")?"hr":"min"}),a&&(clearInterval(a),a=null),p.removeClass("td-n"),g.removeClass("td-bounce"),g.addClass("td-drag"),i=!0;var s=l.offset(),o={y:s.top+l.height()/2,x:s.left+l.width()/2},c="touchstart"==e.type?e.originalEvent.touches[0]:e,u=180/Math.PI,f=o.y-c.pageY,v=o.x-c.pageX,m=Math.atan2(f,v)*u;_td_init_deg=m<0?360+m:m;var h=function(t){t.preventDefault(),t.stopPropagation(),c="touchmove"==t.type?t.originalEvent.touches[0]:t,f=o.y-c.pageY,v=o.x-c.pageX,m=Math.atan2(f,v)*u,m<0&&(m=360+m);var e=m-_td_init_deg+A;e<0&&(e=360+e),e>360&&(e-=360),j.hasClass("td-hr")?L(e):F(e)},k=function(e){e.preventDefault(),e.stopPropagation(),i=!1,d=setTimeout(function(){d=null},100),r.autoSwitch&&W(j.hasClass("td-hr")?E:M),p.addClass("td-n"),g.addClass("td-bounce"),g.removeClass("td-drag"),t(window).off("touchmove mousemove",h),t(window).off("touchend mouseup",k),n.trigger("TDEx-dailing",{finish:!0,selector:j.hasClass("td-hr")?"hr":"min"})};t(window).on("touchmove mousemove",h),t(window).on("touchend mouseup",k)}};k.on("touchstart mousedown",R);var $=function(t){j&&(t.preventDefault(),t.stopPropagation(),a&&(clearInterval(a),a=null),i||(p.removeClass("td-n"),A+=t.originalEvent.wheelDelta/120,A<0&&(A=360+A),A>360&&(A-=360),j.hasClass("td-hr")?L(A):F(A)))};r.mousewheel&&l.on("mousewheel",$);var G=function(t){var e;if(t)o&&(clearInterval(o),o=null,b.addClass("td-on")),e=3600*t.getHours()+60*t.getMinutes()+t.getSeconds();else{if(o)return;o=setInterval(function(){i=new Date,e=3600*i.getHours()+60*i.getMinutes()+i.getSeconds(),U(e,!0)},500),b.removeClass("td-on");var i=new Date;e=3600*i.getHours()+60*i.getMinutes()+i.getSeconds()}e!=S&&(u.addClass("td-n"),U(e,null!==o),n.trigger("TDEx-reset",{sourceTime:t}),setTimeout(function(){u.removeClass("td-n")},500))},J=function(){l.css({top:n.offset().top+n.outerHeight()+(r.dropTrigger?0:8),left:n.offset().left+n.outerWidth()/2-l.outerWidth()/2})},K=function(t){J()},N=function(e){if(!l.hasClass("td-show")){switch(r.visualContainer||(J(),t(window).on("resize",K)),l.addClass("td-show").removeClass("td-"+r.animation+"out").addClass("td-"+r.animation+"in"),r.handleShake&&(a=setInterval(function(){g.addClass("td-alert"),setTimeout(function(){g.removeClass("td-alert")},1e3)},2e3)),G(e||I(r.fetchTime())),r.startFrom){case"hr":W(M);break;case"min":W(E)}n.trigger("TDEx-show",{})}},O=function(){l.hasClass("td-show")&&(o&&(clearInterval(o),o=null,b.addClass("td-on")),a&&(clearInterval(a),a=null),n.trigger("TDEx-hide",{visible:!0}),r.visualContainer||t(window).off("resize",K),setTimeout(function(){W(null),l.removeClass("td-show"),n.trigger("TDEx-hide",{visible:!1})},700),l.addClass("td-"+r.animation+"out").removeClass("td-"+r.animation+"in"))},V=function(t){l.hasClass("td-show")?O():N()};return r.dropTrigger&&n.on("click",V),n.addClass("td-input"),n.data("TDEx",{show:N.bind(this),hide:O.bind(this),refocus:function(t){switch(t){case"hr":W(M);break;case"min":W(E)}},defocus:function(){W(null)},getTime:function(){var t=Math.floor(S/3600),e=S%3600,n=Math.floor(e/60);return[S,_(t,n,e%60)]},isDailing:function(){return i},setTime:function(t){if("string"==typeof t){var e=I(t);return e&&(G(e),W(null)),e}if(t instanceof Date||null===t)return G(t),W(null),t;throw new Error("Unrecognized time object - "+t)},destroy:function(){n.trigger("TDEx-destroy",{}),D.off("click",X),l.off("click",Y),r.meridians&&(C.off("click",B),C.off("click",Q)),r.dropTrigger&&n.off("click",V),k.off("touchstart mousedown",R),r.mousewheel&&l.off("mousewheel",$),l.remove()}}),r.autoStart&&setTimeout(N.bind(this),0),this}})});